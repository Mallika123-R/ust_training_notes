package com.product.service;

import com.product.model.Product;
import com.product.repository.ProductRepository;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;


@ExtendWith(MockitoExtension.class)
class ProductServiceTest {
    @Mock
    private ProductRepository repository;
    @InjectMocks
    private ProductService service;
    private Product product1;
    private Product product2;
    List<Product> productList=new ArrayList<>();
    Optional optionalProduct;
    @BeforeEach
    void setUp() {
          product1=new Product();
          product1.setId(1);
          product1.setProductName("Laptop");
          product1.setProductPrice(23456.77);
          product1.setQuantity(12);
          product2=new Product();
          product2.setProductName("Mobile");
          product2.setProductPrice(13456.77);
          product2.setQuantity(20);
          optionalProduct=Optional.of(product1);
          productList.add(product1);
          productList.add(product1);
    }

    @AfterEach
    void tearDown() {
        product1=null;
        product2=null;
        repository.deleteAll();
    }

    @Test
    void addProductDetails() {
        when(repository.save(any())).thenReturn(product1);
        Product x=repository.save(product1);
        assertEquals("Laptop",x.getProductName());
        assertEquals(23456.77,x.getProductPrice());
        verify(repository,times(1)).save(any());

    }
    @Test
    void getAllProducts() {
        repository.save(product1);
        when((repository.findAll())).thenReturn(productList);
        List<Product> list = repository.findAll();
        assertEquals("Laptop", list.get(0).getProductName());
        assertEquals(23456.77, list.get(0).getProductPrice());
        verify(repository, times(1)).findAll();
    }
    @Test
    void getProductById() {
        repository.save(product1);
        when(repository.findById(anyInt())).thenReturn(optionalProduct);
        Optional<Product> byId = repository.findById(product1.getId());
        assertEquals(1,byId.get().getId());
        assertEquals("Laptop",byId.get().getProductName());
        verify(repository,times(1)).findById(anyInt());
    }

    @Test
    void deleteProduct() {
    }

    @Test
    void deleteProductByid() {
    }

    @Test
    void updateProduct() {
    }
}

PRODUCT CONTROLLER TESTING

-------package com.product.controller;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.product.model.Product;
import com.product.service.ProductService;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.MockitoAnnotations;
import org.mockito.junit.jupiter.MockitoExtension;
import org.springframework.http.MediaType;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.MockMvcBuilder;
import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;
import org.springframework.test.web.servlet.result.MockMvcResultHandlers;
import org.springframework.test.web.servlet.setup.MockMvcBuilders;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.*;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

@ExtendWith(MockitoExtension.class)
class ProdutControllerTest {

    private MockMvc mockMvc;
    @Mock
    private ProductService service;

    @InjectMocks
    private ProdutController controller;

    private Product product;
    private List<Product> productList;
    Optional optionalProduct;

    @BeforeEach
    void setUp() {
        MockitoAnnotations.initMocks(this);
        mockMvc= MockMvcBuilders.standaloneSetup(controller).build();
        product=new Product();
        product.setId(1);
        product.setProductName("Laptop");
        product.setProductPrice(23456.77);
        product.setQuantity(12);
        productList=new ArrayList<>();
        productList.add(product);
    }

    @AfterEach
    void tearDown() {
        product=null;
        productList=null;
    }

    @Test
    void addProductDetails() throws Exception {
        when(service.addProductDetails(any())).thenReturn(product);
        mockMvc.perform(post("/product/add").contentType(MediaType.APPLICATION_JSON).content(new ObjectMapper().writeValueAsString(product)))
                .andExpect(status().isCreated())
                .andDo(MockMvcResultHandlers.print());
        verify(service,times(1)).addProductDetails(any());
    }

    @Test
    void findProductById() throws Exception {
        service.addProductDetails(product);
        when(service.getProductById(anyInt())).thenReturn(product);
        mockMvc.perform(get("/product/find/1").contentType(MediaType.APPLICATION_JSON).content(new ObjectMapper().writeValueAsString(product)))
                .andExpect(status().isFound())
                .andDo(MockMvcResultHandlers.print());
        verify(service,times(1)).getProductById(anyInt());
    }

    @Test
    void deleteProductById() {
    }

    @Test
    void deleteProduct() {
    }

    @Test
    void updateProduct() {
    }
}


\Assignment

https://gitlab-ust.stackroute.in/stack_mccts007_java/maincourse_java_jfse_mc04_outcome03_01/-/tree/master



https://gitlab-ust.stackroute.in/stack_mccts007_java/maincourse_java_jfse_mc04_outcome03_01

